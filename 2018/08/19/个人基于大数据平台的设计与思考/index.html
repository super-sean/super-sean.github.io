<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>个人基于大数据平台的设计与思考 | Sean's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">个人基于大数据平台的设计与思考</h1><a id="logo" href="/.">Sean's Blog</a><p class="description">随性随心</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">个人基于大数据平台的设计与思考</h1><div class="post-meta">Aug 19, 2018<span> | </span><span class="category"><a href="/categories/设计/">设计</a></span></div><div class="post-content"><h3 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h3><p>&ensp; &ensp; 本人是在一家TOB电商平台的创业公司就职，目前负责整个数据部门的架构与业务跟进。之前从事过YY与唯品会的web开发工作，也有了解到一些大数据架构相关的设计。<br>&ensp; &ensp; 目前数据部门的技术架构发展大体方向已经确定得差不多，于是在此梳理一下设计思路、历程与将要实现的内容。</p>
<h3 id="一开始都是坑"><a href="#一开始都是坑" class="headerlink" title="一开始都是坑"></a>一开始都是坑</h3><p>&ensp; &ensp; 一开始的数据需求都是来源于生意运营的报表，我由负责电商app web转向数据开发，说实话，一开始做报表我心里是拒绝的，但是创业团队为了公司能活下去，什么活不得做。领着几个兄弟搭建了公司的”数据中心”，其实就是个报表系统。当时对hadoop,hive,spark,etl等技术及概念懵懵懂懂。  </p>
<p>&ensp; &ensp; 很快我们发现，第一轮的坑来了，面临两个问题：一，报表需求多，小伙伴们整天在写sql，代码组合数据；二，数据量慢慢大起来，有些地方性能比较差，报表要查很久，有时候影响线上性能，线上出问题总要挨白眼。</p>
<p>&ensp; &ensp; 经过了解对比，我们毅然决定开始自研BI系统(参照superset功能设计)和开启我们的ETL架构设计与实现的开头，独立一套数据环境。其实当时我们心中还有点窃喜，终于可以接触高大上的hadoop全家桶了，选取的技术有hadoop、hive、spark、sqoop和shell脚本来实现我们的第一版数据流程。嗯，这才有点数据中心的样子。</p>
<p>&ensp; &ensp; 然而，跑了一段时间后，随着了解越多知识，才知道我们的情况有多糟糕，当时数据量不到100g，只有两台8核16G的机器（手动捂脸），离线任务依靠时间弱依赖，就算只有两台，运维起来也要花不少时间，sqoop在小数据量小集群的应用场景下性能真的很一般啊，渐渐感觉到这套架构对我们来说也许”太早了”。自研BI方面，很考验写sql的功力，虽然由此我们对mysql的sql编写技巧有很大提升，用了很多奇淫巧技，但是，我们的研发现在都花很多时间写sql啊，而且大家对数据不敏感，反正就是完成开发任务就得了。这段时间确实人心很不稳。。。当然很感谢那时坚持陪着我奋斗的小伙伴们。  </p>
<p>初版架构如下:<br><img src="/2018/08/19/个人基于大数据平台的设计与思考/data-architecture1.png" title="data-architecture1"></p>
<h3 id="有坑就要填"><a href="#有坑就要填" class="headerlink" title="有坑就要填"></a>有坑就要填</h3><p>思考、计划、实现与招聘，我们在1个月内重塑了整个交互流程。</p>
<ul>
<li>数据通过爬虫、收集日志与第三方公司进行业务结合等方式慢慢积累起来  </li>
<li>招来第一位数据分析师，并由他负责BI的输出与日常报表需求  </li>
<li>申请多了几台机器资源  </li>
<li>用azkaban替换shell脚本管理，正式接上任务流  </li>
<li>使用datax替换sqoop  </li>
<li>hadoop、hive及spark主要用来做少量智能化的业务，大部分数据聚合逻辑回迁数据库  </li>
</ul>
<p>这样的数据流程立马解放了开发小伙伴的双手，去做更能体现价值的事情，而且报表输出的质量也大大提高了，机器资源也暂时足够，维护起来还不算特别麻烦。心里舒了一口气。  </p>
<p>架构如下:<br><img src="/2018/08/19/个人基于大数据平台的设计与思考/data-architecture2.png" title="data-architecture2"></p>
<h3 id="业务不断发展，坑坑更健康"><a href="#业务不断发展，坑坑更健康" class="headerlink" title="业务不断发展，坑坑更健康"></a>业务不断发展，坑坑更健康</h3><p>&ensp; &ensp; 这个时候我们的业务数据量已经超过100-200G之间，数据中心的数据量也300g左右，数据库中的中间表特别多。<br>&ensp; &ensp; 现在已经好几位分析师，各自负责自己的需求，经常有数据打架的情况发生，而且制作报表很多依然用的业务源表，有性能问题就使用中间表。<br>&ensp; &ensp; 业务应用越来越多对数据聚合服务有需求，我们都是通过RPC接口来对外服务提供服务,我们经常得深入业务逻辑去提供聚合服务，而且服务对象多，所有服务在数据库聚合，经常影响数据中心整体的服务质量，也出现过多次应用雪崩的情况。<br>&ensp; &ensp; 业务也出现了实时反馈的产品需求  </p>
<h3 id="不断学习探研改造"><a href="#不断学习探研改造" class="headerlink" title="不断学习探研改造"></a>不断学习探研改造</h3><p>我们又再一次进行架构改造  </p>
<ul>
<li>接入otter实现业务数据实时同步  </li>
<li>使用canal + kafka + kafka streams 实现实时数据变更订阅，提供实时聚合服务</li>
<li>开始设计自己的数据字典与数据仓库</li>
<li>采用微服务设计理念，使用spring cloud  </li>
</ul>
<p>架构如下:<br><img src="/2018/08/19/个人基于大数据平台的设计与思考/data-architecture3.png" title="data-architecture3">  </p>
<p>就着这样节奏又走了一段日子</p>
<h3 id="总是会有不如意的地方"><a href="#总是会有不如意的地方" class="headerlink" title="总是会有不如意的地方"></a>总是会有不如意的地方</h3><p>&ensp; &ensp; 此时我们的机器资源也只有近10台一般配置的节点，随着微服务越来越多，而且与其它大数据的工具平台共用，很快又到瓶颈，而且进程多维护起来也是麻烦。<br>&ensp; &ensp; 数据团队的人员由于资源限制没有再新增，而业务缺越来越多需要支持，在生产力方面，数据处理环节明显成为瓶颈。<br>&ensp; &ensp; 此时在数据聚合方面，我们采用了redis作为缓存，但是依然存在缓存击破的情况，导致数据库偶尔会锁表，即使我们已经主从读写分离。</p>
<h3 id="像刀一样，越磨越亮"><a href="#像刀一样，越磨越亮" class="headerlink" title="像刀一样，越磨越亮"></a>像刀一样，越磨越亮</h3><p>我们在新的阶段探研了新的技术  </p>
<ul>
<li>使用ambari管理各种集群</li>
<li>探索数据流任务管理平台，对比了kettle，apache nifi和spring cloud data flow</li>
<li>研究能够快速检索数据且能够横向扩展的技术，如elasticsearch,kafka等</li>
<li>过往我们都是存储及计算一体，像我们对mysql,hive的应用就是典型的先把数据迁移到哪里再进行计算，所以我们也探研了计算分离的技术方案，最终采用presto </li>
</ul>
<h3 id="对于快速发展的创业公司来说好用才是王道，大家舒服才是王道"><a href="#对于快速发展的创业公司来说好用才是王道，大家舒服才是王道" class="headerlink" title="对于快速发展的创业公司来说好用才是王道，大家舒服才是王道"></a>对于快速发展的创业公司来说好用才是王道，大家舒服才是王道</h3><p>&ensp; &ensp;我们的数据量始终没有达到TB级别，可预见如果业务没有新的发展方向，就当前的产品的数据增长速度来看，可以把我们要做的数据平台定义为“小数据量的大数据平台”，机器资源也只是近10台（我知道市场正常搞大数据的机器集群一般都有几十上百台，再次手动捂脸）。<br>最终确定我们架构的方向:  </p>
<ul>
<li>使用otter实时同步我们所有业务数据到我们自己的数据库，减少离线同步的管理和资源成本  </li>
<li>使用canal 监听自己数据库的所有表变化，程序同步序列化数据到kafka中，由业务方使用kafka streams自行订阅，实现业务逻辑</li>
<li>使用azkaban + datax + presto ，实现分布式计算，分离存储与计算环节，完成etl流程  </li>
<li>最终离线数据落地elasticsearch</li>
<li>业务方通过数据平台进行数据需求的自满足及溯源  </li>
</ul>
<p>我们当前的架构如下(蓝色箭头为源头输出，红色箭头指向为输入，黄色箭头为溯源流向，黄色闪电为依存关系):<br><img src="/2018/08/19/个人基于大数据平台的设计与思考/data-architecture4.png" title="data-architecture4">  </p>
<p>而最终稳定版的架构如下:<br><img src="/2018/08/19/个人基于大数据平台的设计与思考/data-architecture5.png" title="data-architecture5">  </p>
<h3 id="智能化的业务"><a href="#智能化的业务" class="headerlink" title="智能化的业务"></a>智能化的业务</h3><p>&ensp; &ensp;近来公司重点发展智能化业务，需要我们支持机器学习相关的算法模型实现及调优，目前还是处于使用python脚本的实现方式及azkaban进行任务训练及提供脚本给程序调用。一方面还不是分布式计算，当然我们也可以用spark解决这个问题，第二方面，支持不了实时训练的场景，虽然我们当前也还没有这种需求。目前这块还是架构规划当中，可能会比较倾向于使用tensorflow,后续有进展再更新。</p>
<h3 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h3><p>&ensp; &ensp; 我始终没觉得自己是一个大数据开发人员，在我看来，web开发与数据开发同样是后端研发，只不过业务不同，使用的技术不同，然而很多研发的基础是一样。语言基础，高并发，大数据量，大吞吐量，分布式，高可用，模式设计，基础算法，调优，使用的工具掌握及理解像redis,zk,es,kafka,mysql这些，运维基础，前端基础，像这些我觉得都是应该掌握的。<br>&ensp; &ensp; 面试过很多大数据的开发，从初级到高级。很多人都只关心一个问题，你们的数据量有多大，你们的集群有多大。我承认这些这两个“指标”确实能说明一些东西，但是对于我面试过的人来说，我的结论是，数据量的大小对于只是一个使用工具的人来说，其实并不重要，因为你也只是用，你从来不深究，为什么要这样设计，为什么要这样实现，有没有办法做得更好，你不了解原理，你不熟悉工具技术，反而看不起数据量小的业务场景，这会让人觉得不成熟。<br>&ensp; &ensp; 当然我也是认为如果有机会接触真正的大量数据的场景，还是得尽量接触，在保证自己有不断提升的觉悟为前提去接触。面试过很多游戏通信行业的真正大数据量场景下的小伙伴，真的不得不提一句，你公司的业务场景只是一方面，不“用”起来，只是负责某个环节的加工还不深究，这样的开发真的不算是大数据研发啊。<br>&ensp; &ensp; <strong>peace &amp; love</strong></p>
</div><div class="tags"><a href="/tags/架构/">架构</a><a href="/tags/数据平台/">数据平台</a></div><div class="post-nav"><a class="pre" href="/2018/10/07/JAVA动态编译-解析文本的简易方法/">JAVA动态编译/解析文本的一种简易方法</a><a class="next" href="/2018/08/14/天然苏打水市场的了解与思考/">天然苏打水市场的了解与分析</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://super-sean.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA/">JAVA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据/">大数据</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据分析/">数据分析</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计/">设计</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/队列/" style="font-size: 15px;">队列</a> <a href="/tags/java基础/" style="font-size: 15px;">java基础</a> <a href="/tags/动态解析/" style="font-size: 15px;">动态解析</a> <a href="/tags/实时流/" style="font-size: 15px;">实时流</a> <a href="/tags/spring/" style="font-size: 15px;">spring</a> <a href="/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a> <a href="/tags/分布式/" style="font-size: 15px;">分布式</a> <a href="/tags/mybatis/" style="font-size: 15px;">mybatis</a> <a href="/tags/架构/" style="font-size: 15px;">架构</a> <a href="/tags/数据平台/" style="font-size: 15px;">数据平台</a> <a href="/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/tags/内存/" style="font-size: 15px;">内存</a> <a href="/tags/生意分析/" style="font-size: 15px;">生意分析</a> <a href="/tags/JAVA基础/" style="font-size: 15px;">JAVA基础</a> <a href="/tags/并发编程/" style="font-size: 15px;">并发编程</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/10/18/并发编程/">并发编程</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/07/JAVA动态编译-解析文本的简易方法/">JAVA动态编译/解析文本的一种简易方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/19/个人基于大数据平台的设计与思考/">个人基于大数据平台的设计与思考</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/14/天然苏打水市场的了解与思考/">天然苏打水市场的了解与分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/11/spring-cloud-stream-基于kafka的使用简析/">spring cloud stream 基于kafka的使用简析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/23/内存与JVM/">内存与JVM</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/22/zk分布式任务队列交互设计/">zk分布式任务队列交互设计</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Sean's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>